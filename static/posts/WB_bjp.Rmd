---
title: "WB"
author: "Najah"
date: "2/03/2021"
params:
  orig_date: 'Original Publish Date: 02 March, 2020'
  update_date: !r paste("Updated on:", format(Sys.time(), '%d %B, %Y'))
output:
  html_document:
    theme: flatly
    toc: TRUE
    toc_float: TRUE
    toc_depth: 3
    number_sections: false
    fig_width: 6            
editor_options: 
  chunk_output_type: inline
---

```{r set up, warning=FALSE, include=FALSE, message= FALSE }

knitr::opts_chunk$set(cache = TRUE,echo = FALSE, message=FALSE, warning = FALSE,fig.width = 16/2, fig.height = 9/2)

library(data.table)
library(tidyverse)
library(kableExtra)
library(cowplot)

`%!in%` = Negate(`%in%`)

select <- dplyr::select
```



```{r}

## reading pc files

ac_19 <- readxl::read_xls("D:/cpr/data/GE_PC_AC-main/2019_AC_PC.xls")

ac_14 <-  readxl::read_xlsx("D:/cpr/data/GE_PC_AC-main/2014_AC_PC.xlsx")

#ac_19 <- ac_19 %>% group_by(`State-UT Code & Name`, `AC NO`) %>% mutate(ac_votes=(sum(`VOTES SECURED EVM`, na.rm = TRUE)))

## not filtering nota and ind now since that is needed to calculate votes

wb_19 <- ac_19 %>% filter(`State-UT Code & Name` == "West Bengal" ) %>% ungroup()

## changing to CPIM to CPM

wb_19 <- wb_19 %>% mutate(PARTY = ifelse(PARTY == "CPIM","CPM",PARTY))




wb_14 <- ac_14 %>% filter(`State-UT Code & Name` == "West Bengal" )

wb_14_19 <- rbindlist(list(wb_14,wb_19), use.names = FALSE)

names(wb_14_19) <- tolower(names(wb_14_19))

## changing variable names to append with ac


wb_14_19 <- wb_14_19 %>% rename(state_name = `state-ut code & name`, pc_no = pcno, pc_name = `pc name`, constituency_no = `ac no`, constituency_name = `ac name`, electors = `total electors in ac`, candidate = `candidate name`,votes = `votessecured evm`)


## creating new vote share variable



wb_14_19<- wb_14_19 %>% group_by(year, constituency_no) %>% mutate(election_type = "GE",valid_votes=sum(votes, na.rm = TRUE), vote_share_percentage =( votes/valid_votes)*100,
                                                                   turnout_percentage = (valid_votes/electors)*100) %>% ungroup()

 wb_14_19  <- wb_14_19  %>% group_by(year, constituency_no) %>%  mutate(position = order(order(vote_share_percentage, decreasing=TRUE))) %>% ungroup()
 
 
pc_ac_wb <- wb_14_19 %>%  ungroup() %>% filter(position==1 & year ==2019) %>% select(pc_no, pc_name,  constituency_no,constituency_name)

write.csv(pc_ac_wb, "D:/cpr/elections/wb/pc_ac.csv")

## Q - does valid votes include NOTA too?
## adding position


 
 
 ### victory margin but only for first
 

#  
 wb_14_19 <- wb_14_19 %>% arrange(year, constituency_no,-position)%>% group_by(year, constituency_no) %>% mutate( margin_percentage = vote_share_percentage-lag(vote_share_percentage, default = 0))
# 
# wb_14_19 %>% group_by(year, constituency_no)%>% mutate(victory_margin = margin(position==1))
 
 
## reading ac files
 
 wb_ac <- read_csv("D:/cpr/data/tcpd/states/West_Bengal_2020.csv")

names(wb_ac) <- tolower(names(wb_ac))

wb_11_16 <- wb_ac %>% filter(year %in% c(2011,2016) & poll_no ==0)


wb_16 <- wb_11_16 %>% filter(year==2016)

wb_el <- rbindlist(list(wb_14_19, wb_11_16), use.names = TRUE, fill = TRUE)

wb_el <- wb_el %>% mutate(front = case_when(party %in% c("CPM", "CPI", "RSP", "AIFB") ~"LF",
                                   TRUE ~party))
wb_el <- wb_el %>% ungroup()

#& PARTY != "IND" & PARTY!= "NOTA"

#unique(wb_14$PARTY)


#wb_el %>% filter(year == 2019 & position %in% c(1,2)) %>% group_by(party) %>% summarise(n())


```

# Prelim analysis{.tabset}



## Party vote share


```{r}

wb_el <- wb_el  %>% group_by(year) %>% mutate(total_votes_state = sum(votes))

wb_el %>% group_by(year, front) %>% summarise(vs = (sum(votes)/total_votes_state)*100) %>% filter(front %in% c("AITC"  , "BJP",   "INC" , "LF"  )) %>% 
  ggplot(aes(factor(year), vs,group=front, color = front))+
  #geom_bar(stat= "identity", position= "dodge")
  geom_point()+
  geom_line(size = 1)+
  scale_color_manual(values = c("BJP" = "orange",
                                "INC" = "steelblue", 
                                "LF" = "red",
                                "AITC" = "darkgreen")) +
  labs(title = "Vote share of the major parties in the state", y = "Percentage of votes", x = "Year", color = "Party")+
  ylim(0,50)+
  theme_minimal_hgrid()+
  theme(legend.position = "bottom",
        text = element_text(family="serif"),
                            )
        



```

## Seats


```{r}


# wb_el %>% filter(position==1)%>%  group_by(year, front) %>% summarise(count = n()) %>% 
#   ggplot(aes(factor(year), count, fill =front))+
#   geom_bar(stat= "identity", position= "dodge")+
#   facet_wrap(~election_type)
  
wb_el %>% filter(position==1)%>%  group_by(year, front) %>% summarise(count = n())%>% filter(front %in% c("AITC"  , "BJP",   "INC" , "LF"  )) %>% 
  ggplot(aes(factor(year), count, group =front, color = front))+
  #geom_bar(stat= "identity", position= "dodge")
  geom_point()+
  geom_line(size = 1)+
  scale_color_manual(values = c("BJP" = "orange",
                                "INC" = "steelblue", 
                                "LF" = "red",
                                "AITC" = "darkgreen")) +
  ylim(0,250)+
  labs(title = "Seat share of the major parties in the state", y = "Number of seats", x = "Year", color = "front")+
  theme_minimal_hgrid()+
  theme(legend.position = "bottom",
        text = element_text(family="serif"),
                            )
```


## Turnout


```{r}

wb_el %>% group_by(year) %>% summarise(turnout = mean(turnout_percentage)) %>% 
  ggplot(aes(factor(year), turnout, group= 1))+
  geom_point()+
  geom_line(size =1)+
  ylim(70,90)+
  labs(title = "Turnout percentage in the state", y = "Tunrout percentage", x = "Year")+
  theme_minimal_hgrid()+
  theme(legend.position = "bottom",
        text = element_text(family="serif"),
                            )

```

---

## Strike rate


```{r}

wb_el %>% group_by(election_type,front) %>% summarise(contested = n(), won = sum(position==1)) %>%filter(front %in% c("AITC"  , "BJP",   "INC" , "LF"  ))  %>% mutate(strike_rate = (won/contested)*100) %>% 
  ggplot(aes( factor(front, level = c("AITC", "INC", "LF", "BJP")),strike_rate, fill =election_type))+

  geom_bar(stat="identity", position="dodge")+
  labs(title = "Strike rate of parties in the state", y = "Strike rate (%)", x = "Parties", fill = "Election")+
  colorspace::scale_fill_discrete_qualitative(palette= "Dark 2")+
  ylim(0,80)+
  theme_minimal_hgrid()+
  theme(legend.position = "bottom",
        text = element_text(family="serif"),
                            )


```

## Victory margin

![](D:/cpr/misc/analysis/margin_wb.png)

```{r}

# wb_el %>% filter(position==1) %>% group_by(election_type,party) %>% summarise(margin= mean(margin_percentage)) %>% 
#   filter(party %in% c("AITC"  , "BJP",   "INC" , "CPM"  )) %>% 
#     ggplot(aes( factor(party, level = c( "INC","AITC" ,"BJP","CPM")),margin, fill =election_type))+
# 
#   geom_bar(stat="identity", position="dodge")+
#   labs(title = "Margin percentage of parties in the state", y = "Margin (%)", x = "Parties", fill = "Election")+
#   colorspace::scale_fill_discrete_qualitative(palette= "Dark 2")+
#   ylim(0,15)+
#   theme_minimal_hgrid()+
#   theme(legend.position = "bottom",
#         text = element_text(family="serif"))
#  
        
        
# wb_el %>% filter(position==1) %>% group_by(election_type,year,front) %>% summarise(margin= mean(margin_percentage)) %>% 
#   filter(front %in% c("AITC"  , "BJP",   "INC" , "LF"  )) %>% 
#     ggplot(aes(factor(year), margin, group =front, color = front))+
#   #geom_bar(stat= "identity", position= "dodge")
#   geom_point()+
#   geom_line(size = 1)+
#   scale_color_manual(values = c("BJP" = "orange",
#                                 "INC" = "steelblue", 
#                                 "LF" = "red",
#                                 "AITC" = "darkgreen")) +
#   ylim(0,20)+
#   labs(title = "Vicory vargin percentage of  major parties in the state", y = "Margin(%)", x = "Year", color = "front")+
#   theme_minimal_hgrid()+
#   theme(legend.position = "bottom",
#         text = element_text(family="serif"),
#                             )


  

```


<!-- ## BJP vote share trends -->

<!-- where is it gaining from -->

<!-- ```{r} -->
<!-- ##2019 -->

<!-- bjp_19 <- wb_el %>% filter(year ==2019 & front == "BJP") %>% select(constituency_no, vote_share_percentage) %>% rename(BJP = vote_share_percentage) -->

<!-- inc_19 <- wb_el %>% filter(year ==2019 & front == "INC") %>% select(constituency_no, vote_share_percentage) %>% rename(INC = vote_share_percentage) -->

<!-- aitc_19 <- wb_el %>% filter(year ==2019 & front == "AITC") %>% select(constituency_no, vote_share_percentage) %>% rename(AITC = vote_share_percentage) -->
<!-- LF_19 <- wb_el %>% filter(year ==2019 & front == "LF") %>% select( constituency_no, vote_share_percentage) %>%  rename(LF = vote_share_percentage) -->

<!-- vs_reg <- full_join(bjp_19, aitc_19, by='constituency_no') %>% -->
<!--                 left_join(., inc_19, by='constituency_no') %>%  -->
<!--   left_join(., LF_19, by='constituency_no')  -->

<!-- ##2016 -->


<!-- bjp_16 <- wb_el %>% filter( year ==2016 &front == "BJP") %>% select(constituency_no, vote_share_percentage) %>% rename(BJP_16 = vote_share_percentage) -->

<!-- inc_16 <- wb_el%>% filter(year ==2016 &front == "INC") %>% select(constituency_no, vote_share_percentage) %>% rename(INC_16 = vote_share_percentage) -->

<!-- aitc_16 <-wb_el %>% filter(year ==2016 & front == "AITC") %>% select(constituency_no, vote_share_percentage) %>% rename(AITC_16 = vote_share_percentage) -->
<!-- LF_16 <- wb_el %>% filter(year ==2016 & front == "LF") %>% select( constituency_no, vote_share_percentage) %>%  rename(LF_16 = vote_share_percentage) -->

<!-- vs_reg <- full_join(bjp_19, aitc_19, by='constituency_no') %>% -->
<!--                 left_join(., inc_19, by='constituency_no') %>%  -->
<!--   left_join(., LF_19, by='constituency_no')  -->

<!-- vs_reg_16 <- full_join(aitc_16, bjp_16, by='constituency_no') %>% -->
<!--                 left_join(., LF_16, by='constituency_no') %>%  -->
<!--   left_join(., inc_16, by='constituency_no')  -->


<!-- vs_change <- full_join(vs_reg, vs_reg_16, by ='constituency_no' ) -->


<!-- vs_change <- vs_change %>% mutate(aitc_delta = AITC-AITC_16, bjp_delta = BJP-BJP_16, -->
<!--                      inc_delta = INC -INC_16, -->
<!--                      lf_delta = LF-LF_16) -->
<!-- ``` -->


<!-- ## Model -->


<!-- I ran a simple regression model with vote share change of parties in each constituencies in 2019 wrt 2016 election. The dependent variable is BJP's vote share change. It seems that CPM is paying a huge price for BJPs rising dominance. CPM is losing 1.7 percentage point votes as BJP gains one percentage point votes. -->

<!-- ```{r} -->

<!-- ## model -->


<!-- m1 <- lm(data = vs_change, bjp_delta ~ aitc_delta + inc_delta + lf_delta) -->

<!-- library(stargazer) -->


<!-- stargazer(m1, type = "html") -->
<!-- ``` -->














# Spatial distribution{.tabset}


## Seats won



```{r results = 'hide'}
library(sf)

ac_shp <- st_read("D:/cpr/data/shape-file/maps-master/assembly-constituencies/India_AC.shp",quiet = TRUE)



ac_wb <- ac_shp %>% filter(ST_NAME == "WEST BENGAL")

party_19 <-  wb_el %>% ungroup()%>% filter(year ==2019& position==1) %>% select(constituency_no, party) 

party_19_ac <- inner_join(ac_wb, party_19, by = c("AC_NO"= "constituency_no"))
```


```{r results = 'hide'}
ggplot(party_19_ac)+
  geom_sf(aes(fill= party), lwd = .8)+
  scale_fill_manual(values = c("BJP" = "orange",
                                "INC" = "steelblue", 
                                "AITC" = "darkgreen"))+
    theme_map()+
    labs(title ="Constituencies won by Party", subtitle = "2019 WB elections")+
    theme(text = element_text(family = "serif"))


```

## Vote share distribution

```{r}

# 
# ggplot(ac_wb)+
#   geom_sf()

bjp_19 <- wb_el %>% filter( year ==2019 &front == "BJP") %>% select(constituency_no, front,vote_share_percentage) %>% rename(BJP_19 = vote_share_percentage) 


bjp_ac <- inner_join(ac_wb, bjp_19, by = c("AC_NO"= "constituency_no"))


ggplot(bjp_ac)+
  geom_sf(aes(fill= BJP_19))+
  theme_map()+
   colorspace::scale_fill_continuous_sequential(palette = "Oranges")



```



# BJP vote share


BJP's vote share in constituencies won by following parties -

Second column indicates the vote share recieved by the party in the constituencies it has won. Second column indicates BJP's vote share from the same set of constituencies.

```{r}
bjp_19 <- wb_el %>% filter( year ==2019 &front == "BJP") %>% select(constituency_no, front,vote_share_percentage) %>% rename(BJP_19 = vote_share_percentage) 

winner_19 <- wb_el %>% filter( year ==2019 &position==1) %>% select(constituency_no,front, vote_share_percentage) %>% rename(winner_19 = vote_share_percentage, front_19= front)


winner_16 <-  wb_el %>% filter( year ==2016 &position==1) %>% select(constituency_no,front, vote_share_percentage) %>% rename(winner_16 = vote_share_percentage, front_16 = front)

front_16_19 <- full_join(winner_16, winner_19, by = "constituency_no") %>% 
  left_join(.,bjp_19, by = "constituency_no")
```

**2019**




```{r}
front_16_19 %>% group_by(front_19) %>% summarise(mean_winner_vote_share = mean(winner_19, na.rm = TRUE),mean_bjp_vote_share = mean(BJP_19, na.rm = TRUE)) %>% filter(front_19 %!in% c("GOJAM", "IND")) %>% 
  rename( winner_16= front_19) %>% kable()%>% kable_styling(bootstrap_options = "striped")
```


**2016**


```{r}
front_16_19 %>% group_by(front_16) %>% summarise(mean_winner_vote_share = mean(winner_16, na.rm = TRUE),mean_bjp_vote_share = mean(BJP_19, na.rm = TRUE)) %>% filter(front_16 %!in% c("GOJAM", "IND")) %>% 
  rename( winner_16= front_16) %>% kable()%>% kable_styling(bootstrap_options = "striped")


```



#  Women Turnout{.tabset}




Scraped women turnout data from west bengal sec annual reports. No success in finding female turnout for other years yet- . lmk if you know any.


## AE 16

```{r}



wb_16 <- wb_16 %>% ungroup()
fe_to <- read.csv("D:/cpr/elections/wb/female_TO_16.csv")

wb_16<- wb_16 %>% mutate(front = case_when(party %in% c("CPM", "CPI", "RSP", "AIFB") ~"LF",
                                   TRUE ~party))

wb_16_fe <- inner_join(wb_16, fe_to, by = c("constituency_no" = "ac.no"))

wb_16_fe_aitc <- wb_16_fe %>% filter(party=="AITC")

wb_16_fe_3 <- wb_16_fe %>% filter(front%in%c("BJP",  "AITC"))

# ggplot(wb_16_fe_aitc, aes(female_turnout, vote_share_percentage))+
#   geom_point()

ggplot(wb_16_fe_3, aes(female_turnout, vote_share_percentage, color = front))+
  geom_point(alpha=0.5)+
  geom_smooth()+
  scale_color_manual(values = c("BJP" = "orange",
                                
                                "AITC" = "darkgreen")) +
  labs(title = "Female turnout v/s Vote share of the major parties in the state", y = "Vote share(%)",subtitle = "2016 WB Assembly election", x = "Turnout (%)", color = "Party")+
  ylim(0,80)+
  theme_minimal_grid()+
  theme(legend.position = "bottom",
        text = element_text(family="serif"),
                            )

```




pranav's piece on [women electors](https://www.livemint.com/Politics/PyQ7hlxIkiyXlsUqq7JbOL/The-growing-importance-of-women-as-an-electoral-constituency.html)


## GE 19


```{r}
wb_19_to <- read.csv("D:/cpr/elections/wb/turnout_wb_19.csv")


ge <- fread("D:/cpr/data/tcpd/TCPD_GE_all.csv")

wb_ge_19 <- ge %>% filter(Year ==2019 & State_Name =="West_Bengal" & Party %in% c("BJP", "AITC"))



wb_ge_to <- inner_join(wb_ge_19, wb_19_to, by = c("Constituency_No"= "pc_no"))

ggplot(wb_ge_to, aes(FEMALE.1, Vote_Share_Percentage, color = Party))+
  geom_point(alpha=0.8)+
  geom_smooth()+
  scale_color_manual(values = c("BJP" = "orange",
                                
                                "AITC" = "darkgreen")) +
  labs(title = "Female turnout v/s Vote share of the major parties in the state", y = "Vote share(%)",subtitle = "2019 WB General election", x = "Turnout (%)", color = "Party")+
  lims(x = c(65,90), y= c(10,65))+
  theme_minimal_grid()+
  theme(legend.position = "bottom",
        text = element_text(family="serif"),
                            )


```


---


# Muslims{.tabset}

Muslims percentage at AC level aggregated using Raphael's booth level data.

## All AE and GE elections- Post 2009
```{r}


muslim_pc <- read.csv("D:/cpr/elections/wb/muslim_pc_14.csv")

names(muslim_pc)[1] <- "ac_no"

wb_el_mus <- inner_join(wb_el, muslim_pc, by = c("constituency_no" = "ac_no"))

ggplot(wb_el_mus %>% filter(front%in%c("BJP",  "AITC")), aes(muslim_pc, vote_share_percentage, color = front))+
  geom_point(alpha=0.4)+
  geom_smooth()+
  scale_color_manual(values = c("BJP" = "orange",
                                
                                "AITC" = "darkgreen")) +
  labs(title = "Muslim voters v/s Vote share of the major parties in the state", y = "Vote share(%)",subtitle = "2011:19 WB elections", x = "Muslim voters (%)", color = "Party")+
  xlim(20,80)+
  theme_minimal_grid()+
  theme(legend.position = "bottom",
        text = element_text(family="serif"),
                            )


```

## AE elections

```{r}

ggplot(wb_el_mus %>% filter(front%in%c("BJP",  "AITC")& election_type =="AE"), aes(muslim_pc, vote_share_percentage, color = front))+
  geom_point(alpha=0.4)+
  geom_smooth()+
  scale_color_manual(values = c("BJP" = "orange",

                                "AITC" = "darkgreen")) +
  labs(title = "Muslim voters v/s Vote share of the major parties in the state", y = "Vote share(%)",subtitle = "2011 & 2016 AE elections", x = "Muslim voters (%)", color = "Party")+
  xlim(20,80)+
  theme_minimal_grid()+
  theme(legend.position = "bottom",
        text = element_text(family="serif"),
                            )

```


## GE elections


```{r}

ggplot(wb_el_mus %>% filter(front%in%c("BJP",  "AITC")& election_type =="GE"), aes(muslim_pc, vote_share_percentage, color = front))+
  geom_point(alpha=0.5)+
  geom_smooth()+
  scale_color_manual(values = c("BJP" = "orange",
                              
                                
                                "AITC" = "darkgreen")) +
  labs(title = "Muslim voters v/s Vote share of the major parties in the state", y = "Vote share(%)",subtitle = "2014 & 2019 GE elections", x = "Muslim voters (%)", color = "Party")+
  xlim(20,80)+
  theme_minimal_grid()+
  theme(legend.position = "bottom",
        text = element_text(family="serif"),
                            )

```

# Reserved constiteuncies{.tabset}


## SC and ST seperate

```{r}
wb_el <- wb_el %>% ungroup()



res <- wb_el %>% filter(year==2016 & position==1) %>% select(constituency_no, constituency_type) %>% rename(reservation=constituency_type )

table(res$reservation)

wb_el_res <- inner_join(wb_el, res, by= "constituency_no")

wb_el_res %>% filter(year %in% c(2016,2019)) %>% group_by(year,reservation, party) %>% summarise(vs = mean(vote_share_percentage)) %>% filter(party %in% c("BJP","AITC")) %>% 
  ggplot(aes(reservation, vs, fill = party))+
  geom_bar(stat= "identity", position = "dodge")+
  facet_wrap(~year)+
  scale_fill_manual(values = c("BJP" = "orange",
                                "AITC" = "darkgreen")) +
  labs(title = "Average vote share percentage wrt constiteuncy type", x = "Constituency type", y = "Vote share(%)" )+
    theme_minimal_hgrid()+
  theme(legend.position = "bottom",
        text = element_text(family="serif"),
                            )
```

## SC and ST aggregate


```{r}
res_table <- wb_el_res %>% filter(year %in% c(2016,2019)) %>% group_by(year,reservation, party) %>% summarise(vs = mean(vote_share_percentage)) %>% filter(party %in% c("BJP","AITC"))

res_table$reservation1 <- ifelse(res_table$reservation == "GEN", "GEN", "SC/ST")

ggplot(res_table,(aes(reservation1, vs, fill = party)))+
  geom_bar(stat= "identity", position = "dodge")+
  facet_wrap(~year)+
    scale_fill_manual(values = c("BJP" = "orange",
                                "AITC" = "darkgreen"))+
  labs(title = "Average vote share percentage wrt constiteuncy type", x = "Constituency type", y = "Vote share(%)" )+
    theme_minimal_hgrid()+
  theme(legend.position = "bottom",
        text = element_text(family="serif"),
                            )

  

```

## boxplot



```{r}

wb_el_res$reservation1 <-  ifelse(wb_el_res$reservation == "GEN", "GEN", "SC/ST")

ggplot(wb_el_res %>% filter(party %in% c("BJP","AITC")& year %in% c(2016,2019)), aes(reservation1, vote_share_percentage, fill = party))+
  geom_boxplot()+
  facet_wrap(~year)+
    scale_fill_manual(values = c("BJP" = "orange",
                                "AITC" = "darkgreen"))+
  labs(title = "Average vote share percentage wrt constiteuncy type", x = "Constituency type", y = "Vote share(%)", fill = "Party" )+
    theme_minimal_hgrid()+
  theme(legend.position = "bottom",
        text = element_text(family="serif"),
                            )


```




---


# sub region


```{r}

sub_reg <- read.csv("D:/cpr/elections/wb/pc_ac.csv")

names(sub_reg) <- tolower(names(sub_reg))

sub_reg <- sub_reg  %>% select(-c(pc_no, pc_name, constituency_name))



wb_el_reg <- inner_join(wb_el, sub_reg, by= "constituency_no" )

```


```{r}
wb_el_reg %>% filter(party %in% c("BJP", "AITC") & year %in% c(2016,2019)) %>% group_by(year,sub_region_ht, party) %>% summarise(vs= mean(vote_share_percentage)) %>% 
  ggplot((aes(factor(sub_region_ht, level = c("Hills", "South Bengal","Jangalmahal", "North Bengal", "Central Bengal")), vs, fill = party)))+
  geom_bar(stat= "identity", position="dodge")+
  facet_wrap(~year)+
    labs(title = "Vote share  of parties wrt sub region", y = "Vote share (%)", x = "Sub region", fill = "Election")+
  scale_fill_manual(values = c("BJP" = "orange",
                                "AITC" = "darkgreen"))+
  ylim(0,50)+
  theme_minimal_hgrid()+
  theme(legend.position = "bottom",
        text = element_text(family="serif"),
        axis.text.x = element_text(angle = 45,hjust = 1))
  
```



# Census variables



```{r}

# shrug_cen <- read.csv("D:/cpr/elections/wb/wb_shrug_census.csv")
# 
# shrug_cen$ac_no <- as.numeric(str_sub(shrug_cen$ï..ac08_id,-3))
# 
# shrug_cen <- dplyr::full_join(wb_el, shrug_cen, by = c("constituency_no" = "ac_no")) %>% 
#  full_join(.,muslim_pc, by = c("constituency_no" ="ac_no" )) %>% ungroup()
# 
# wb_16_19

```


regressions?






<!-- # WB old -->





<!-- This document focuses on the 2016  state and 2019 national election held in Bengal. -->

<!-- <!-- ## reading the 2014 7 2019 ac level files to merge --> -->


<!-- ```{r} -->

<!-- #ac_19 <- readxl::read_xls("D:/cpr/data/GE_PC_AC-main/2019_AC_PC.xls") -->

<!-- #wb_19 <- ac_19 %>% filter(`State-UT Code & Name` == "West Bengal" & PARTY != "IND") -->

<!-- # ac_14 <- readxl::read_xlsx("D:/cpr/data/GE_PC_AC-main/2014_AC_PC.xlsx") -->
<!-- #  -->
<!-- # wb_14 <- ac_14 %>% filter(`State-UT Code & Name` == "West Bengal" & PARTY != "IND") -->
<!-- #  -->
<!-- # wb_14 <- wb_14 %>% rename_all(paste0, "_14") -->

<!-- # wb_14_bjp <- wb_14 %>% filter(PARTY_14 == "BJP") -->
<!-- #  -->
<!-- # wb_19_bjp <- wb_19 %>% filter(PARTY == "BJP") -->

<!-- #names(wb_14) -->

<!-- #unique(wb_14$AC.NAME) -->


<!-- # wb_14_19 <- inner_join(wb_19, wb_14, by = c("PC NO" = "PCNO_14","AC NO"= "AC NO_14", "PARTY" = "PARTY_14")) -->
<!-- #  -->
<!-- # wb_14_19_bjp <- inner_join(wb_19_bjp, wb_14_bjp, by = c("PC NO" = "PCNO_14","AC NO"= "AC NO_14")) -->


<!-- #merge(wb_19,wb_14, by.x = c("PC NO", "AC NO", "PARTY"), by.y = c("PCNO_14", "AC.NO_14" , "PARTY_14")) -->

<!-- #str(wb_14) -->

<!-- #  -->
<!-- # wb_14_19_bjp <- wb_14_19_bjp %>% mutate(vote_share_pc_14 = `VOTESSECURED EVM_14`/`TOTAL ELECTORS IN AC_14`*100,vote_share_pc_19 = `VOTES SECURED EVM`/`TOTAL ELECTORS` *100, vote_share_change = vote_share_pc_19 - vote_share_pc_14) -->
<!-- #  -->
<!-- # change <- wb_14_19_bjp %>% select(`AC NAME`, vote_share_change) -->
<!-- #  -->
<!-- # ggplot(change, aes(vote_share_change))+ -->
<!-- #   geom_density(fill = "steelblue")+ -->
<!-- #   labs(title = "Change BJP vote share in West Bengal", subtitle = "From 2014 to 2019")+ -->
<!-- #   theme_minimal() -->


<!-- ``` -->



<!-- ```{r} -->
<!-- wb_ac <- read_csv("D:/cpr/data/tcpd/states/West_Bengal_2020.csv") -->

<!-- names(wb_ac) <- tolower(names(wb_ac)) -->

<!-- wb_11_16 <- wb_ac %>% filter(year %in% c(2011,2016) & poll_no ==0) -->









<!-- #wb_16 <- wb_ac %>% filter(year ==2016 & poll_no==0 & party!= "IND" & party!= "NOTA"& constituency_no!=51) -->

<!-- wb_16 <- wb_16 %>% group_by(constituency_no)%>% mutate(winner_16 = party[position==1]) -->
<!-- #  -->
<!-- # table(wb_16$winner_16) -->
<!-- #  -->
<!-- # wb_16 %>%group_by(constituency_no) %>% tally() -->

<!-- wb_19 <- wb_19 %>% mutate(vote_share_pc_19 = `VOTES SECURED EVM`/ac_votes *100, ) -->

<!-- wb_19  <- wb_19 %>% group_by(`AC NO`) %>%  mutate(position_19 = order(order(vote_share_pc_19, decreasing=TRUE)))  -->

<!-- wb_19 <- wb_19 %>% group_by(`AC NO`)%>% mutate(winner_19 = PARTY[position_19==1]) -->
<!-- wb_16_19 <- right_join(wb_16, wb_19, by = c("constituency_no"="AC NO", "party"="PARTY")) -->

<!-- #wb_16_19 %>% filter(position==1) -->

<!-- #wb_16_19_anti <- anti_join(wb_16, wb_19, by = c("constituency_no"="AC NO", "party"="PARTY")) -->


<!-- # wb_16 %>% filter(constituency_no==51) -->




<!-- ``` -->


<!-- ## seats won by parties at AS level -->

<!-- ```{r} -->

<!-- seats_19 <- wb_16_19 %>% filter(Year ==2019) %>% filter(position_19==1) %>%group_by(party) %>%  summarise(seats_19 =n()) -->

<!-- seats_16 <- wb_16_19 %>% filter(year ==2016) %>% filter(position==1) %>%group_by(party) %>%  summarise(seats_16 =n()) %>% arrange(-seats_16) -->

<!-- seats_16_19 <- left_join(seats_16, seats_19, by = "party") -->

<!--  seats_16_19 <- seats_16_19  %>% mutate(seats_19 = replace_na(seats_19 ,0))  -->

<!--  seats_16_19 %>% kable(digits =2) %>% kable_styling(bootstrap_options = "striped") -->

<!-- ``` -->
<!-- --- -->

<!-- ## vote share of parties in 2016 & 2019 elections -->

<!-- ```{r} -->

<!-- vs_19 <- wb_16_19 %>% filter(Year ==2019) %>% group_by(party) %>%  summarise(vs_19 = sum(`VOTES SECURED EVM`)/sum(ac_votes)*100) -->


<!-- vs_16 <- wb_16_19 %>% filter(year ==2016) %>% group_by(party) %>%  summarise(vs_16 =sum(votes)/sum(valid_votes)*100) -->

<!-- vs_16_19 <- left_join(vs_16, vs_19, by = "party") -->

<!-- vs_16_19  %>% mutate(vs_19 = replace_na(vs_19 ,0)) %>% arrange( -vs_19,-vs_16) %>% slice(1:7) %>% kable(digits =2)%>% kable_styling(bootstrap_options = "striped") -->

<!-- ``` -->






<!-- <!-- ## BJPs gain --> -->

<!-- <!-- Following table shows the vote share gained by BJP in  2019  from the constituencies won by these parties in 2016. --> -->

<!-- ```{r} -->

<!--  wb_19_bjp <- wb_19 %>% filter(PARTY == "BJP" ) -->

<!-- wb_16_winner <- wb_16 %>% filter(position==1) -->
<!-- wb_16_19_bjp <-  inner_join(wb_16_winner, wb_19_bjp, by = c("constituency_no"="AC NO")) -->
<!-- #  -->
<!-- # wb_16_19_bjp <- wb_16_19_bjp %>% filter(position==1) -->
<!-- #  -->
<!-- #  -->
<!-- # wb_16_19  %>% mutate(winner_16 = party[position==1]) -->
<!-- #  -->
<!-- #  -->
<!-- # wb_16_19_b %>% filter(party == "AITC" & position==1) %>% select() -->


<!-- # wb_16_19_bjp %>% group_by(party) %>% summarise(vs_16 = mean(vote_share_percentage), bjp_vs_19 = mean(vote_share_pc_19)) -->

<!-- # wb_16_19_bjp %>% group_by(party) %>% summarise(winner_vs_16 = sum(votes[position==1])/sum(valid_votes)*100, bjp_vs_19 =sum(`VOTES SECURED EVM`)/sum(ac_votes)*100) %>% kable(digits =2)%>% kable_styling(bootstrap_options = "striped") -->

<!-- # wb_16_19 %>% filter(Year == 2019) %>% group_by(party) %>% summarise(vs_19 = sum(`VOTES SECURED EVM`)/sum(ac_votes)*100) %>% filter(party %in% c(AIFB, AITC,BJP,CPI,CPM,)) -->

<!-- # wb_16_19_bjp %>% group_by(party) -->
<!-- #  -->
<!-- # wb_16_19 %>% group_by(party) %>% summarise(winner_vs_16 = mean(vote_share_percentage[position==1], na.rm = TRUE), vs_19= mean(vote_share_pc_19), -->
<!-- #                                            bjp_vs_19 =vote_share_pc_19[party == "BJP"]) %>% kable(digits =2)%>% kable_styling(bootstrap_options = "striped") -->
<!-- #  -->
<!-- #  -->
<!-- # wb_16  %>% group_by(party) %>% summarise(winner_vs_16 = mean(vote_share_percentage[position==1], na.rm = TRUE),bjp_vs = mean(vote_share_percentage ) -->
<!-- #  -->
<!-- #  -->
<!-- # wb_19 %>% filter(position_19==1) %>% group_by(PARTY) %>% summarise(winner_vs_19 = mean(vote_share_pc_19, na.rm = TRUE)) -->
<!-- ``` -->



<!-- ```{r} -->

<!-- # wb_19 <- wb_19 %>% group_by(`AC NO`)%>% mutate(winner_19 = PARTY[position_19==1]) -->
<!-- #  -->
<!-- # wb_19 <- wb_19 %>% ungroup() -->
<!-- #  -->
<!-- # wb_19$winner <- wb_19$PARTY[wb_19$position_19==1] -->
<!-- ``` -->

<!-- --- -->

<!-- ## Seat gains by different parties -->


<!-- ```{r} -->
<!-- wb_16_19 %>% filter(position_19==1)%>% group_by(winner_16, winner_19) %>% summarise(count = n()) %>% arrange(-count) %>% kable(digits =2) %>% kable_styling(bootstrap_options = "striped") -->
<!-- ``` -->





<!-- ```{r} -->
<!-- #  -->
<!-- # tmc_bjp <- rbind(wb_16 %>% filter(position==1 & party == "AITC") %>% select(constituency_no, party,vote_share_percentage), -->
<!-- #  -->
<!-- # wb_16 %>% filter(winner_16== "AITC" & party == "BJP") %>% select(constituency_no, party,vote_share_percentage)) -->
<!-- #  -->
<!-- #  -->
<!-- # tmc_bjp %>% mutate(bjp_gain = vote_share_percentage...6-vote_share_percentage...3 ) -->
<!-- #  -->
<!-- #  -->
<!-- # ggplot(tmc_bjp, aes(vote_share_percentage, fill = party))+ -->
<!-- #   geom_density() -->


<!-- ``` -->

<!-- --- -->


<!-- ## BJP vote share gain -->

<!-- Mean percentage of votes BJP has gained 2019 election  since 2016 election from the constituencies won by following parties: -->

<!-- ```{r} -->
<!-- wb_16_19 <- full_join(wb_16, wb_19, by = c("constituency_no"="AC NO", "party"="PARTY")) -->

<!-- wb_16_19 %>% mutate(bjp_change = vote_share_pc_19[party== "BJP"]- vote_share_percentage[party=="BJP"]) %>% filter(position==1) %>% select(constituency_no, party, vote_share_percentage, bjp_change) %>% group_by(party) %>% summarise(pc_gain = mean(bjp_change, na.rm = TRUE)) %>% -->
<!-- arrange(-pc_gain) %>% kable(digits =2)%>% kable_styling(bootstrap_options = "striped") -->


<!-- ``` -->



